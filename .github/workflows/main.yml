name: main

on:
    push:
        branches: ['main']
    pull_request:
        branches: ['main']

jobs:
    build:
        runs-on: ubuntu-latest

        strategy:
            matrix:
                node-version: [18.x]

        steps:
            - uses: actions/checkout@v3

            - name: Use Node.js ${{ matrix.node-version }}
              uses: actions/setup-node@v3
              with:
                  node-version: ${{ matrix.node-version }}

            - name: Install Packages
              run: |
                  npm install

            - name: Format and Lint
              run: |
                  npm run format
                  npm run lint

            - name: Build
              run: |
                  npm run build
            
            - name: Semantic Release
              uses: cycjimmy/semantic-release-action@v4
              with:
                extra_plugins: |
                  @semantic-release/changelog
                  @semantic-release/git
                branches: |
                  [
                    'main',
                    {
                      name: 'alpha',
                      prerelease: true
                    }
                  ]
              env:
                GH_TOKEN: ${{ secrets.GH_TOKEN }}
                
            - name: New Published Release
              if: steps.semantic.outputs.new_release_published == 'true'
              run: |
                  echo ${{ steps.semantic.outputs.new_release_version }}
                  echo ${{ steps.semantic.outputs.new_release_major_version }}
                  echo ${{ steps.semantic.outputs.new_release_minor_version }}
                  echo ${{ steps.semantic.outputs.new_release_patch_version }}
