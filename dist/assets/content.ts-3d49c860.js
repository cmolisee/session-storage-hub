import{A as o,S as a}from"./types-6c8bde6f.js";const i=(e,n,r,t)=>t.id===chrome.runtime.id&&r.from===e&&r.action===n,l=(e,n,r)=>{if(i(a.Extension,o.Request,e,n)){const t=JSON.parse(JSON.stringify(sessionStorage));return r({error:t?null:"Error retrieving session storage",data:t}),!0}return!1},g=(e,n,r)=>{var t;if(i(a.Extension,o.Update,e,n)){try{Object.entries(((t=e.message)==null?void 0:t.updatedData)??{}).forEach(c=>{sessionStorage.setItem(c[0],c[1])});const s=Object.assign({},sessionStorage);r({error:null,data:s})}catch{r({error:"Error updating session storage data",data:null})}return!0}return!1},m=(e,n,r)=>{if(i(a.Extension,o.Clean,e,n)){try{sessionStorage.clear(),Object.entries(e.message.data).forEach(s=>{sessionStorage.setItem(s[0],s[1])});const t=Object.assign({},sessionStorage);r({error:null,data:t})}catch{r({error:"Error cleaning session storage data",data:null})}return!0}return!1},d=(e,n,r)=>{if(i(a.Extension,o.Clear,e,n)){try{sessionStorage.clear(),r({error:null,data:{}})}catch{r({error:"Error clearing session storage data",data:null})}return!0}return!1},h=(e,n,r)=>{if(i(a.Extension,o.FillStorage,e,n)){try{let t=8;for(;t>0;)try{window.sessionStorage.setItem("@utility-fill-"+window.sessionStorage.length.toString(),"@".repeat(2**t))}catch{t-=1}const s=Object.assign({},sessionStorage);r({error:null,data:s})}catch{r({error:"Error filling session storage.",data:null})}return!0}return!1};function y(e){return e/2777777}const f=(e,n,r)=>{if(i(a.Extension,o.Check,e,n)){try{chrome.storage.sync.get("versionData",t=>{if(!e.message||!e.message.timestamp||e.message.forceCheck||!t||!t.timestamp||y(e.message.timestamp-t.timestamp)>5)fetch("https://api.github.com/repos/cmolisee/session-storage-hub/releases/latest").then(s=>s.json()).then(s=>{const u={isUpToDate:s.tag_name.slice(1)==="5.0.1",timestamp:new Date().getTime(),releaseUrl:s.html_url};r({error:null,data:u})}).catch(s=>console.error("Session Storage Hub:",s));else return r({error:null,data:t}),!0})}catch{r({error:"Error checking for updated release",data:{}})}return!0}return!1},S=(e,n,r)=>{if(i(a.Extension,o.Copy,e,n)){const t=e.message.keys,s={};return Object.entries(sessionStorage).forEach(([c,u])=>{t.includes(c)&&(s[c]=u)}),r({error:null,data:s}),!0}return!1},L=(e,n,r)=>{if(i(a.Extension,o.Add,e,n)){try{const t=new Date().getTime().toString();sessionStorage.setItem(t,"{}");const s={obj:Object.assign({},sessionStorage),itemKey:t};r({error:null,data:s})}catch{r({error:"Error adding session storage item",data:null})}return!0}return!1},M=(e,n,r)=>{var t;if(i(a.Extension,o.Delete,e,n)){try{console.log("deleteMessageListener",e),(t=e.message)==null||t.data.forEach(c=>{sessionStorage.removeItem(c)});const s=Object.assign({},sessionStorage);r({error:null,data:s})}catch{r({error:"Error adding session storage item",data:null})}return!0}return!1},E=(e,n,r)=>{if(i(a.Extension,o.UpdateKey,e,n)){try{const{newKey:t,oldKey:s}=e.message;sessionStorage.setItem(t,sessionStorage.getItem(s)),sessionStorage.removeItem(s),r({error:null,data:Object.assign({},sessionStorage)})}catch{r({error:"Error updating session storage data",data:null})}return!0}return!1},p=()=>{chrome.runtime.onMessage.removeListener(l),chrome.runtime.onMessage.removeListener(g),chrome.runtime.onMessage.removeListener(m),chrome.runtime.onMessage.removeListener(d),chrome.runtime.onMessage.removeListener(h),chrome.runtime.onMessage.removeListener(f),chrome.runtime.onMessage.removeListener(S),chrome.runtime.onMessage.removeListener(L),chrome.runtime.onMessage.removeListener(M),chrome.runtime.onMessage.removeListener(E),chrome.runtime.onMessage.addListener(l),chrome.runtime.onMessage.addListener(g),chrome.runtime.onMessage.addListener(m),chrome.runtime.onMessage.addListener(d),chrome.runtime.onMessage.addListener(h),chrome.runtime.onMessage.addListener(f),chrome.runtime.onMessage.addListener(S),chrome.runtime.onMessage.addListener(L),chrome.runtime.onMessage.addListener(M),chrome.runtime.onMessage.addListener(E)};p();export{S as copyStorageToClipboard};
