var inject=function(){"use strict";function C(e){return e==null||typeof e=="function"?{main:e}:e}var M=(e=>(e.WEBPAGE="@ssh/messaging/webpage",e.EXTENSION="@ssh/messagng/extension",e))(M||{});const U=[EvalError,RangeError,ReferenceError,SyntaxError,TypeError,URIError,globalThis.DOMException,globalThis.AssertionError,globalThis.SystemError].filter(Boolean).map(e=>[e.name,e]),k=new Map(U);class v extends Error{name="NonError";constructor(r){super(v._prepareSuperMessage(r))}static _prepareSuperMessage(r){try{return JSON.stringify(r)}catch{return String(r)}}}const F=[{property:"name",enumerable:!1},{property:"message",enumerable:!1},{property:"stack",enumerable:!1},{property:"code",enumerable:!0},{property:"cause",enumerable:!1}],_=new WeakSet,W=e=>{_.add(e);const r=e.toJSON();return _.delete(e),r},P=e=>k.get(e)??Error,O=({from:e,seen:r,to:n,forceEnumerable:l,maxDepth:g,depth:p,useToJSON:s,serialize:u})=>{if(!n)if(Array.isArray(e))n=[];else if(!u&&I(e)){const t=P(e.name);n=new t}else n={};if(r.push(e),p>=g)return n;if(s&&typeof e.toJSON=="function"&&!_.has(e))return W(e);const o=t=>O({from:t,seen:[...r],forceEnumerable:l,maxDepth:g,depth:p,useToJSON:s,serialize:u});for(const[t,i]of Object.entries(e)){if(i&&i instanceof Uint8Array&&i.constructor.name==="Buffer"){n[t]="[object Buffer]";continue}if(i!==null&&typeof i=="object"&&typeof i.pipe=="function"){n[t]="[object Stream]";continue}if(typeof i!="function"){if(!i||typeof i!="object"){try{n[t]=i}catch{}continue}if(!r.includes(e[t])){p++,n[t]=o(e[t]);continue}n[t]="[Circular]"}}for(const{property:t,enumerable:i}of F)typeof e[t]<"u"&&e[t]!==null&&Object.defineProperty(n,t,{value:I(e[t])?o(e[t]):e[t],enumerable:l?!0:i,configurable:!0,writable:!0});return n};function z(e,r={}){const{maxDepth:n=Number.POSITIVE_INFINITY,useToJSON:l=!0}=r;return typeof e=="object"&&e!==null?O({from:e,seen:[],forceEnumerable:!0,maxDepth:n,depth:0,useToJSON:l,serialize:!0}):typeof e=="function"?`[Function: ${e.name||"anonymous"}]`:e}function V(e,r={}){const{maxDepth:n=Number.POSITIVE_INFINITY}=r;if(e instanceof Error)return e;if(Y(e)){const l=P(e.name);return O({from:e,seen:[],to:new l,maxDepth:n,depth:0,serialize:!1})}return new v(e)}function I(e){return!!e&&typeof e=="object"&&"name"in e&&"message"in e&&"stack"in e}function Y(e){return!!e&&typeof e=="object"&&"message"in e&&!Array.isArray(e)}var X=Object.defineProperty,G=Object.defineProperties,q=Object.getOwnPropertyDescriptors,j=Object.getOwnPropertySymbols,H=Object.prototype.hasOwnProperty,Q=Object.prototype.propertyIsEnumerable,N=(e,r,n)=>r in e?X(e,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[r]=n,L=(e,r)=>{for(var n in r||(r={}))H.call(r,n)&&N(e,n,r[n]);if(j)for(var n of j(r))Q.call(r,n)&&N(e,n,r[n]);return e},T=(e,r)=>G(e,q(r)),x=(e,r,n)=>new Promise((l,g)=>{var p=o=>{try{u(n.next(o))}catch(t){g(t)}},s=o=>{try{u(n.throw(o))}catch(t){g(t)}},u=o=>o.done?l(o.value):Promise.resolve(o.value).then(p,s);u((n=n.apply(e,r)).next())});function Z(e){let r,n={};function l(){Object.entries(n).length===0&&(r?.(),r=void 0)}let g=Math.floor(Math.random()*1e4);function p(){return g++}return{sendMessage(s,u,...o){return x(this,null,function*(){var t,i,a,y;const w={id:p(),type:s,data:u,timestamp:Date.now()},m=(i=yield(t=e.verifyMessageData)==null?void 0:t.call(e,w))!=null?i:w;(a=e.logger)==null||a.debug(`[messaging] sendMessage {id=${m.id}} ─ᐅ`,m,...o);const h=yield e.sendMessage(m,...o),{res:c,err:d}=h??{err:new Error("No response")};if((y=e.logger)==null||y.debug(`[messaging] sendMessage {id=${m.id}} ᐊ─`,{res:c,err:d}),d!=null)throw V(d);return c})},onMessage(s,u){var o,t,i;if(r==null&&((o=e.logger)==null||o.debug(`[messaging] "${s}" initialized the message listener for this context`),r=e.addRootListener(a=>{var y,w;if(typeof a.type!="string"||typeof a.timestamp!="number"){if(e.breakError)return;const c=Error(`[messaging] Unknown message format, must include the 'type' & 'timestamp' fields, received: ${JSON.stringify(a)}`);throw(y=e.logger)==null||y.error(c),c}(w=e?.logger)==null||w.debug("[messaging] Received message",a);const m=n[a.type];if(m==null)return;const h=m(a);return Promise.resolve(h).then(c=>{var d,B;return(B=(d=e.verifyMessageData)==null?void 0:d.call(e,c))!=null?B:c}).then(c=>{var d;return(d=e?.logger)==null||d.debug(`[messaging] onMessage {id=${a.id}} ─ᐅ`,{res:c}),{res:c}}).catch(c=>{var d;return(d=e?.logger)==null||d.debug(`[messaging] onMessage {id=${a.id}} ─ᐅ`,{err:c}),{err:z(c)}})})),n[s]!=null){const a=Error(`[messaging] In this JS context, only one listener can be setup for ${s}`);throw(t=e.logger)==null||t.error(a),a}return n[s]=u,(i=e.logger)==null||i.log(`[messaging] Added listener for ${s}`),()=>{delete n[s],l()}},removeAllListeners(){Object.keys(n).forEach(s=>{delete n[s]}),l()}}}for(var f=256,A=[],R=256,E;f--;)A[f]=(f+256).toString(16).substring(1);function K(e){var r=0,n=11;if(!E||f+n>R*2)for(E="",f=0;r<R;r++)E+=A[Math.random()*256|0];return E.substring(f,f+++n)}var D="@webext-core/messaging/window",$="@webext-core/messaging/window/response";function ee(e){const r=e.namespace,n=K();let l=[];const g=(s,u)=>new Promise(o=>{const t=a=>{a.data.type===$&&a.data.namespace===r&&a.data.instanceId!==n&&a.data.message.type===s.type&&(o(a.data.response),i())},i=()=>window.removeEventListener("message",t);l.push(i),window.addEventListener("message",t),window.postMessage({type:D,message:s,senderOrigin:location.origin,namespace:r,instanceId:n},u??"*")}),p=Z(T(L({},e),{sendMessage(s,u){return g(s,u)},addRootListener(s){const u=o=>x(this,null,function*(){if(o.data.type!==D||o.data.namespace!==r||o.data.instanceId===n)return;const t=yield s(o.data.message);window.postMessage({type:$,response:t,instanceId:n,message:o.data.message,namespace:r},o.data.senderOrigin)});return window.addEventListener("message",u),()=>window.removeEventListener("message",u)},verifyMessageData(s){return structuredClone(s)}}));return T(L({},p),{removeAllListeners(){p.removeAllListeners(),l.forEach(s=>s()),l=[]}})}const S=ee({namespace:M.WEBPAGE});function re(e,r=!1){try{return JSON.parse(e)}catch(n){return r&&console.debug("Error parsing object: ",n),e}}function J(e){return re(JSON.stringify(e))}const ne=C(()=>{S.sendMessage("updateToExtension",J(window.sessionStorage)).catch(r=>console.debug(r)),S.onMessage("updateFromExtension",r=>(sessionStorage.clear(),Object.assign(sessionStorage,r.data),window.dispatchEvent(new StorageEvent("storage",{storageArea:window.sessionStorage})),!0));const e=r=>{S.sendMessage("updateToExtension",J(r.storageArea)).catch(n=>console.debug(n))};window.removeEventListener("storage",e),window.addEventListener("storage",e)});function se(){}function b(e,...r){}const te={debug:(...e)=>b(console.debug,...e),log:(...e)=>b(console.log,...e),warn:(...e)=>b(console.warn,...e),error:(...e)=>b(console.error,...e)};return(async()=>{try{return await ne.main()}catch(e){throw te.error('The unlisted script "inject" crashed on startup!',e),e}})()}();
inject;
